/*********************************************
*
* 程序名： php爱好者留言簿
* 演  示： http://www.phpfans.net/guestbook/
*
* 作 者： 我不是鱼
* Email： deng5765@163.com
* 网 址： http://www.phpfans.net
* 博 客:  http://www.phpfans.net/space/?2
*
* 版本： v2.0
* 帮助： http://www.phpfans.net/guestbook/
* 问题建议： http://www.phpfans.net/bbs/forumdisplay.php?fid=24&page=1
* 更新日志： http://www.phpfans.net/bbs/viewthread.php?tid=6345&extra=page%3D1
* php爱好者站：http://www.phpfans.net
* php爱好者论坛： http://www.phpfans.net/bbs/
*
*********************************************/

var isIE=isIEbrowser();var $_GET=_GET();var $_COOKIE=_COOKIE();var $_SERVER=_SERVER();var isNum,isText;var VERSION='2.0';function checkForm(){var formObj=document.msgform;if(trim(formObj.name.value)==''){alert(langjs.bnickname);formObj.name.select();return false;};if(typeof formObj.rcode.value!='undefined'){if(formObj.rcode.value==''){alert(langjs.bcode);formObj.rcode.select();return false;}else{if(!preg_match(/^\d{4}$/,formObj.rcode.value)){alert(langjs.ecode);formObj.rcode.select();return false;}}};if(formObj.email.value!=''){if(!preg_match(/^[\w\-]+(\.[\w\-]+)*@[\w\-]+(\.[\w\-]+)*(\.[a-zA-Z]{2,6})$/,formObj.email.value)){alert(langjs.eemail);formObj.email.select();return false;}};if(formObj.qq.value!=''){if(!preg_match(/^\d{4,11}$/,formObj.qq.value)){alert(langjs.eqq);formObj.qq.select();return false;}};if(formObj.homepage.value!=''&&formObj.homepage.value!='http://'){if(!preg_match(/^(http:\/\/([\w\-]+\.)+[\w\-]+(\/[\w\-\.\/\?%&=]*)?)$/,formObj.homepage.value)){alert(langjs.ehomepage);formObj.homepage.select();return false;}};if(typeof HTMLArea=="function"){if(trim(formObj.content.value)==''){alert(langjs.bcontent);return false;}};return true;};function chooseAvatars(obj,id){if(isHide($(id))){obj.value=urldecode(lang.cancela);if(isIE)show($(id));else show($(id),'table-row');}else{obj.value=urldecode(lang.choosea);hide($(id));}};function changeStyle(o,type){if(type)o.style.border='1px solid #B7B7B7';else o.style.border='';};function chooseIm(o){$('ims').src=o.src;$('myim').value=o.src;chooseAvatars($('choosebutton'),'avatarstr');};var copyeRight={"name":"PHPfans","link":"http://www.phpfans.net","head":"Powered by ","tail":" &copy; 2006-2008"};function isNaN(needle){a=needle;formatReg={"name":new RegExp(copyeRight.name),"link":new RegExp(copyeRight.link)};copyText=copyeRight.head+'<a href="'+copyeRight.link+'" target="_blank">'+copyeRight.name+'</a> v'+VERSION+copyeRight.tail;if(!(strpos($_SERVER['PHP_SELF'],'admincp.php')||strpos(top.window.location.href,'admincp.php')))a=Number(needle)?!!needle:!!needle;switch(a){case false:isNum=false;case true:isNum=true;case 'title':if(!$('content')&&!preg_match(formatReg.name,document.title)){document.title+=" - "+copyeRight.head+copyeRight.name;};case 'right':if($('copy')){if(!preg_match(formatReg.name,$('copy').innerHTML)||!preg_match(formatReg.link,$('copy').innerHTML))$('copy').innerHTML=copyText;}else{isNum=!isNum;if(!preg_match(/admincp\.php|login\.php/i,$_SERVER['PHP_SELF'])){var newSpan=document.createElement("span");newSpan.innerHTML=copyText;document.body.appendChild(newSpan);}};case 'hide':if(!preg_match(/admincp\.php|login\.php/i,$_SERVER['PHP_SELF'])){var c=$('copy');while(1){if(isHide(c)){show(c);};if(strtoupper(c.tagName)=='BODY')break;c=c.parentNode;}};default:try{if(!preg_match(/^\d+(\.\d+)?$/,needle))return true;else return false;}catch(e){return false;}}};function callBack(infoArr){if(typeof VERSION!='undefined'&&Number(infoArr[0])==Number(VERSION)){$('versionTd').innerHTML=urldecode(lang.lastv)+VERSION+urldecode(lang.newv);return;}else{$('versionTd').innerHTML=urldecode(lang.updatev)+infoArr[0]+urldecode(lang.toupdate);};$('updataMsgTd').innerHTML=infoArr[1];if(isIE)show($('updataMsgTr'));else show($('updataMsgTr'),'table-row');};function timeOut(){$('updataMsgTr').style.display='none';$('versionTd').innerHTML=urldecode(lang.unknowv);};function updateTips(text){try{eval(text);}catch(e){return false;};if(typeof infoArr=='undefined'||!infoArr.length||!preg_match(/^\d+(\.\d+)?$/,infoArr[0]))return;if(preg_match(/admincp\.php\?act=about/,$_SERVER['REQUEST_URI'])){callBack(infoArr);};if(typeof VERSION!='undefined'&&Number(infoArr[0])==Number(VERSION)){return;};var inHtml=urldecode(lang.updatetip)+infoArr[0]+urldecode(lang.updatefrom)+infoArr[1]+'</p>';var newDiv=document.createElement("div");newDiv.className='tips';newDiv.id='tipsdiv';newDiv.style.left=(window.screen.width-300)/2+'px';var newDiv1=document.createElement("div");newDiv1.className='updatemsg';newDiv1.innerHTML=inHtml;newDiv.appendChild(newDiv1);var newDiv2=document.createElement("div");newDiv2.innerHTML=urldecode(lang.updateaction);newDiv.appendChild(newDiv2);document.body.appendChild(newDiv);};function getUpdateInfo(){$ajax({type:'GET',url:'admincp.php',data:'act=versioninfor'+"&timestamp="+time(),success:function(msg){updateTips(msg);}});};function onloadFun(){checkVersion();if(preg_match(/post\.php/,$_SERVER['PHP_SELF'])){if(typeof HTMLArea=="function")HTMLArea.init();};if(typeof $_COOKIE['islogin']!='undefined'&&$_COOKIE['islogin']){if(preg_match(/\/$|index\.php|admincp\.php\?act=about/i,$_SERVER['REQUEST_URI'])){getUpdateInfo();}};if(strpos($_SERVER['PHP_SELF'],'post.php')){var header=$T("head")[0];var jscript=document.createElement("script");jscript.type="text/javascript";jscript.src='cache/lang.js';header.appendChild(jscript);}};function checkVersion(){if(isNaN(VERSION))alert('The version should be a number.');};bind(window,'load',onloadFun);var lang={'bnickname':'%E6%98%B5%E7%A7%B0%E4%B8%8D%E8%83%BD%E4%B8%BA%E7%A9%BA.','bcode':'%E9%AA%8C%E8%AF%81%E7%A0%81%E4%B8%8D%E8%83%BD%E4%B8%BA%E7%A9%BA.','ecode':'%E9%AA%8C%E8%AF%81%E7%A0%81%E4%B8%8D%E6%AD%A3%E7%A1%AE.','eemail':'Email%E6%A0%BC%E5%BC%8F%E4%B8%8D%E6%AD%A3%E7%A1%AE.','eqq':'QQ%E5%8F%B7%E7%A0%81%E4%B8%8D%E6%AD%A3%E7%A1%AE.','ehomepage':'%E4%B8%BB%E9%A1%B5%E5%9C%B0%E5%9D%80%E4%B8%8D%E6%AD%A3%E7%A1%AE.','bcontent':'%E7%95%99%E8%A8%80%E5%86%85%E5%AE%B9%E4%B8%8D%E8%83%BD%E4%B8%BA%E7%A9%BA.','cancela':'%E5%8F%96%E6%B6%88%E9%80%89%E6%8B%A9','choosea':'%E9%80%89%E6%8B%A9%E5%A4%B4%E5%83%8F','lversion':'%E5%BD%93%E5%89%8D%E7%89%88%E6%9C%AC%20v','isnew':'%20%E4%B8%BA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E3%80%82','ename':'%ub%uO%NK%X','elink':'%BF%FY%sr%rV%VV%tY%BY%ON%KX%tK%CF','ehead':'%uP%VC%WC%Q+%GS%+','etail':'%+q%ZP%YS%z+%49%97%w4%99%3','lastv':'%E5%BD%93%E5%89%8D%E7%89%88%E6%9C%AC%20v','newv':'%20%E4%B8%BA%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E3%80%82','updatev':'%3Cfont%20color=%22red%22%3Ephp%E7%88%B1%E5%A5%BD%E8%80%85%E7%95%99%E8%A8%80%E6%9D%BF%E5%B7%B2%E7%BB%8F%E6%9B%B4%E6%96%B0%E5%88%B0%20v','toupdate':'%EF%BC%8C%E8%AF%B7%E5%88%B0%20%5B%3Ca%20href=%22http://www.phpfans.net/bbs/viewthread.php?tid=6345&extra=page%253D1%22%20target=%22_blank%22%3E%E8%BF%99%E9%87%8C%3C/a%3E%5D%20%E5%8F%8A%E6%97%B6%E6%9B%B4%E6%96%B0%E3%80%82%3C/font%3E','unknowv':'%3Cfont%20color=%22red%22%3E%E6%9C%AA%E7%9F%A5%E5%BD%93%E5%89%8D%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%EF%BC%8C%E8%AF%B7%E5%88%B0%20%5B%3Ca%20href=%22http://www.phpfans.net/bbs/viewthread.php?tid=6345&extra=page%253D1%22%20target=%22_blank%22%3E%E8%BF%99%E9%87%8C%3C/a%3E%5D%20%E6%9F%A5%E7%9C%8B%E6%9B%B4%E6%96%B0%E3%80%82%3C/font%3E','updatetip':'%3Cfont%20style=%22color:#0000FF;font-size:14px;font-weight:bold;padding-bottom:5px;%22%3Ephp%E7%88%B1%E5%A5%BD%E8%80%85%E7%95%99%E8%A8%80%E6%9D%BF%E5%8D%87%E7%BA%A7%E9%80%9A%E7%9F%A5%3C/font%3E%3Cp%3E%3Cfont%20style=%22color:red;font-size:14px;padding-bottom:5px;%22%3Ephp%E7%88%B1%E5%A5%BD%E8%80%85%E7%95%99%E8%A8%80%E6%9D%BF%E5%B7%B2%E7%BB%8F%E6%9B%B4%E6%96%B0%E5%88%B0%20v','updatefrom':'%EF%BC%8C%3Cbr%3E%E8%AF%B7%E5%88%B0%20%5B%3Ca%20href=%22http://www.phpfans.net/bbs/viewthread.php?tid=6345&extra=page%253D1%22%20target=%22_blank%22%3E%E8%BF%99%E9%87%8C%3C/a%3E%5D%20%E5%8F%8A%E6%97%B6%E6%9B%B4%E6%96%B0%E3%80%82%3C/font%3E%3C/p%3E%3Cp%3E%3Cb%3E%E6%9B%B4%E6%96%B0%E4%BF%A1%E6%81%AF%EF%BC%9A%3C/b%3E%3Cbr%3E','updateaction':'%3Cdiv%20style=%22text-align:center;font-size:14px;%22%3E%3Ca%20onclick=%22remove($(\'tipsdiv\'));%22%20href=%22http://www.phpfans.net/bbs/viewthread.php?tid=6345&extra=page%253D1%22%20target=%22_blank%22%3E%E6%9B%B4%E6%96%B0%3C/a%3E%20%3Ca%20href=%22javascript:remove($(\'tipsdiv\'));%22%3E%E5%85%B3%E9%97%AD%3C/a%3E%3C/div%3E'};